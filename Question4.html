<html>
    <head>
        <title>Question 4</title>
        <h1>Jack Wason 6780957</h1>

        <script>
            // make AJAX query
            function doAjaxQueryTest()
            {
                // create an XMLHttpRequest
                var xhttp = new XMLHttpRequest();

                // creating a handler for readyState change
                xhttp.onreadystatechange = function()
                {
                    readyStateChangeHandler(xhttp);
                };

                // making query by async cal
                xhttp.open("GET", "Question4.json", true);
                xhttp.send();
            }

            function readyStateChangeHandler(xhttp)
            {
                if (xhttp.readyState == 4)
                {
                    // when readyState = 4 means DONE

                    if(xhttp.status == 200)
                    {
                        // when status = 200 means OK
                        handleStatusSuccess(xhttp);
                    }
                    else
                    {
                        // status is NOT OK
                        handleStatusFailure(xhttp);
                    }
                }
            }

            // XMLHttpRequest failed
            function handleStatusFailure(xhttp)
            {
                // show error message
                var displayDiv = document.getElementById("display");

                displayDiv.innerHTML = "XMLHttpRequest failed: status " + xhttp.statuse;

            }

            //XMLHttpRequest succeeded
            function handleStatusSuccess(xhttp)
            {
                var jsonText = xhttp.responseText;

                // parse json to an object
                var testObj = JSON.parse(jsonText);

                // display object on page
                displayTestResults(testObj);
            }

            // display the test result object on the page
            function displayTestResults(testObj)
            {
                // print the testObj on the console
                // console.log(testObj)

                // construct HTML code to display the test result information
                var html = "<h2>Test Results. Student Reference Number: " + testObj.studentRefNumber + "</h2>";

                html += "<table border='0' style='height: 50%'>";

                html += "<tr><th>Question</th><th align='left'>Content</th><th align='left'>Topic</th><th>Correct Answer</th><th>Your Answer</th><th align='left'>Difficulty</th>";

                for(var i=0; i < testObj.testResult.length; i++)
                {

                    var resultsObj = testObj.testResult[i];

                    // make the td background grey for wrong answer
                    if( resultsObj.yourAnswer != resultsObj.correctAnswer)
                    {
                        html += "<tr>";

                        html += "<td style='background-color: grey' align='center'>" + resultsObj.questionNumber + "</td>";
                    }
                    else
                    {
                        html += "<tr>";

                        html += "<td align='center'>" + resultsObj.questionNumber + "</td>";
                    }

                    // display the content, topic and correct answer information
                    html += "<td>" + resultsObj.content + "</td>";

                    html += "<td>" + resultsObj.topic + "</td>";

                    html += "<td align='center'>" + resultsObj.correctAnswer + "</td>";
                    
                    // green tick for yourAnswer being correct
                    if( resultsObj.yourAnswer == resultsObj.correctAnswer)
                    {
                        html += "<td align='center' style='color: green'>&#10003</td>";
                    }
                    else
                    {
                        html += "<td align='center'>" + resultsObj.yourAnswer + "</td>";
                    }

                    // stars to show dfficulty level
                    if( resultsObj.difficultyLevel == 1)
                    {
                        html += "<td>&#11088</td>";
                    }
                    if( resultsObj.difficultyLevel == 2)
                    {
                        html += "<td>&#11088&#11088</td>";
                    }
                    if( resultsObj.difficultyLevel == 3)
                    {
                        html += "<td>&#11088&#11088&#11088</td>";
                    }
                    if( resultsObj.difficultyLevel == 4)
                    {
                        html += "<td>&#11088&#11088&#11088&#11088</td>";
                    }
                    if( resultsObj.difficultyLevel == 5)
                    {
                        html += "<td>&#11088&#11088&#11088&#11088&#11088</td>";
                    }

                    html += "</tr>";
                }

                html += "</table>";

                var displayDiv = document.getElementById("display");
                displayDiv.innerHTML = html;
            }
        </script>
    </head>

    <body>
        <button onClick="doAjaxQueryTest()">
            Get Test Result
        </button>

        <br /><br />

        <div id="display">
        </div>

    </body>
</html>